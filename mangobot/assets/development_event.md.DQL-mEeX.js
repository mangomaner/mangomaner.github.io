import{_ as i,c as a,o as e,ah as n}from"./chunks/framework.DVDh7XOs.js";const d=JSON.parse('{"title":"事件系统","description":"","frontmatter":{},"headers":[],"relativePath":"development/event.md","filePath":"development/event.md"}'),t={name:"development/event.md"};function l(h,s,p,r,k,o){return e(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="事件系统" tabindex="-1">事件系统 <a class="header-anchor" href="#事件系统" aria-label="Permalink to “事件系统”">​</a></h1><p>MangoBot 的核心是基于事件驱动的。了解事件系统对于开发插件至关重要。</p><h2 id="事件类型" tabindex="-1">事件类型 <a class="header-anchor" href="#事件类型" aria-label="Permalink to “事件类型”">​</a></h2><p>所有事件都继承自 <code>io.github.mangomaner.mangobot.model.onebot.event.Event</code> 类。主要的事件类型包括：</p><h3 id="消息事件-messageevent" tabindex="-1">消息事件 (MessageEvent) <a class="header-anchor" href="#消息事件-messageevent" aria-label="Permalink to “消息事件 (MessageEvent)”">​</a></h3><p>当机器人收到消息时触发。</p><h4 id="groupmessageevent" tabindex="-1">GroupMessageEvent <a class="header-anchor" href="#groupmessageevent" aria-label="Permalink to “GroupMessageEvent”">​</a></h4><p>群消息事件</p><p><strong>常用方法：</strong></p><ul><li><code>getGroupId()</code> - 获取群号</li><li><code>getUserId()</code> - 获取消息发送者 QQ 号</li><li><code>getMessageId()</code> - 获取消息 ID</li><li><code>getParsedMessage()</code> - 获取解析后的自然语言消息</li><li><code>getSelfId()</code> - 获取机器人 QQ 号</li></ul><h4 id="privatemessageevent" tabindex="-1">PrivateMessageEvent <a class="header-anchor" href="#privatemessageevent" aria-label="Permalink to “PrivateMessageEvent”">​</a></h4><p>私聊消息事件</p><p><strong>常用方法：</strong></p><ul><li><code>getUserId()</code> - 获取消息发送者 QQ 号</li><li><code>getMessageId()</code> - 获取消息 ID</li><li><code>getParsedMessage()</code> - 获取解析后的自然语言消息</li><li><code>getSelfId()</code> - 获取机器人 QQ 号</li></ul><hr><h3 id="通知事件-noticeevent" tabindex="-1">通知事件 (NoticeEvent) <a class="header-anchor" href="#通知事件-noticeevent" aria-label="Permalink to “通知事件 (NoticeEvent)”">​</a></h3><p>当发生群成员变动、好友请求、戳一戳等系统通知时触发。</p><p><strong>包含的方法：</strong></p><ul><li><code>getSelfId()</code> - 获取机器人 QQ 号</li><li><code>getTime()</code> - 获取事件时间</li><li><code>getPostType()</code> - 获取消息类型</li></ul><p><strong>常见通知类型：</strong></p><ul><li>群成员增加/减少</li><li>群管理员变动</li><li>好友请求</li><li>群禁言/解禁</li><li>戳一戳</li></ul><h2 id="事件处理流程" tabindex="-1">事件处理流程 <a class="header-anchor" href="#事件处理流程" aria-label="Permalink to “事件处理流程”">​</a></h2><ol><li><strong>接收</strong>: WebSocket 接收到 OneBot 发来的 JSON 数据</li><li><strong>解析</strong>: <code>EventParser</code> 根据 <code>post_type</code> 字段将 JSON 解析为对应的 <code>Event</code> 对象</li><li><strong>分发</strong>: <code>MangoEventPublisher</code> 遍历所有注册的监听器</li><li><strong>执行</strong>: 按照优先级顺序调用监听器方法</li><li><strong>反馈</strong>: 监听器可以通过 API 服务向 OneBot 客户端发送响应</li></ol><h2 id="事件监听器" tabindex="-1">事件监听器 <a class="header-anchor" href="#事件监听器" aria-label="Permalink to “事件监听器”">​</a></h2><h3 id="mangoboteventlistener" tabindex="-1">@MangoBotEventListener <a class="header-anchor" href="#mangoboteventlistener" aria-label="Permalink to “@MangoBotEventListener”">​</a></h3><p>标记方法为事件监听器。</p><p><strong>参数规则：</strong></p><ul><li>方法参数必须是 <code>Event</code> 的子类且非抽象类</li><li>只允许传入一个参数</li></ul><p><strong>返回值：</strong></p><ul><li><code>boolean</code>: 返回 <code>false</code> 将中断事件传播，后续优先级较低的监听器将不会收到该事件</li></ul><p><strong>示例：</strong></p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MangoBotEventListener</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MessageEvent event) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;收到消息: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 继续传播</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MangoBotEventListener</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleGroupMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GroupMessageEvent event) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;收到群消息: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRawMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 中断事件传播</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="pluginpriority" tabindex="-1">@PluginPriority <a class="header-anchor" href="#pluginpriority" aria-label="Permalink to “@PluginPriority”">​</a></h3><p>控制监听器的执行顺序，数值越小优先级越高。</p><p><strong>！禁止传入小于0的优先级！</strong></p><p><strong>默认优先级：</strong> 10</p><p><strong>示例：</strong></p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MangoBotEventListener</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PluginPriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 优先级最高，先执行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> highPriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MessageEvent event) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 处理高优先级逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MangoBotEventListener</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PluginPriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 优先级较低，后执行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lowPriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MessageEvent event) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 处理低优先级逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>优先级使用场景：</strong></p><ul><li>1-10: 紧急处理，如权限检查、命令拦截</li><li>11-50: 常规业务逻辑</li><li>51-100: 日志记录、统计等辅助功能</li></ul><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to “最佳实践”">​</a></h2><ol><li><strong>合理设置优先级</strong>：避免所有插件都使用相同优先级导致执行顺序混乱</li><li><strong>快速返回</strong>：监听器方法应快速执行，避免阻塞事件分发</li><li><strong>异常处理</strong>：在监听器中添加适当的异常处理，避免影响其他插件</li><li><strong>事件中断</strong>：谨慎使用返回 <code>false</code> 中断事件传播，确保不会意外阻止其他插件</li><li><strong>日志记录</strong>：使用 Logger 记录关键操作和错误信息</li></ol>`,42)])])}const E=i(t,[["render",l]]);export{d as __pageData,E as default};
